---
title: EchoScript for Map Mock
description: Learning EchoScript to modify HTTP(s) request/response
---

import { Image } from 'astro:assets';
import MaterialSymbolsMapOutline from '~icons/material-symbols/map-outline';
import { inlineIcon } from "../../../styles/styles.ts"
import echoScriptImage from '../../../assets/map-echoscript.png';


**EchoScript** is the core of Map Mock. It can work with both Map Local and Map Remote.

<Image src={echoScriptImage} style="border-radius:3px;" alt="EchoScript" />

By default, EchoScript code is commented out, which means it does nothing.
```go
// on_request := func(env, req) {
//   return {}
// }

// on_response := func(env, res) {
//   return {}
// }
```

## Callback functions
EchoScript has two standard callback functions: on_request and on_response,
which can be used to modify HTTP(s) request and response respectively.

### on_request
The return value of **on_request** is a **map**, which tells EchoProxy how to modify HTTP(s) request.
Return an empty map **\{\}** means it does nothing.

```go
on_request := func(env, req) {
  return {}
}
```

:::note
**on_request** is called when EchoProxy receives a new HTTP(s) request from client.
:::

The structure of on_request **return** value. All fields are optional.
```json
{
  // change request method, value can be GET/POST/PUT ...
  method: string,
  // change request URL
  url: string,
  // change request URL query parameters, merge with original map
  query: map,
  // change request header key/value pairs, merge with original map
  header: map,
  // change request cookie key/value pairs, merge with original map
  cookie: map,
  // change request body: a map, string or file
  body: map|string|file
}
```

### on_response
The return value of **on_response** is a **map**, which tells EchoProxy how to modify HTTP(s) response.
Return an empty map **\{\}** means it does nothing.

```go
on_response := func(env, res) {
  return {}
}
```

:::note
**on_response** is called when EchoProxy has received the response of HTTP(s) remote request (MapRemote),
or has loaded the response from local file (MapLocal).
:::

The structure of on_response **return** value. All fields are optional.
```json
{
  // change response HTTP status code, value can be 200/302/404 ...
  code: int,
  // change response header key/value pairs, merge with original map
  header: map,
  // change response cookie key/value pairs, merge with original map
  cookie: map,
  // change response body: a map, string or file
  body: map|string|file
}
```

### Example


## Function arguments
### req
The argument **req** represents the incoming HTTP **request**. The structure of **req**:
```json
{
  u: array,         // an array holds Wildcard or Regex match results
  url: string,      // request URL
  method: string,   // request method
  query: map,       // request URL query parameters
  header: map,      // request header key/value pairs
  cookie: map,      // request cookie key/value pairs
  body: map|string, // request body: a map or string
  text: string      // request body as text string

  client_ip: string,   // client IP
  client_addr: string, // client address
}
```

### res
The argument **res** represents the **response** got from remote HTTP request (MapRemote),
or the **response** loaded from local file (MapLocal). The structure of **res**:
```json
{
  code: int,        // response HTTP status code
  header: map,      // response header key/value pairs
  cookie: map,      // response cookie key/value pairs
  body: map|string, // response body: a map or string
  text: string      // response body as text string
}
```

### env
TODO

### Example

## Argument fields
### req.query
